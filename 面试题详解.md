## 面试题详解

### 1、APK包含了哪些东西，打包过程是什么？
#### APK组成：

**(1)、classes.dex：**这是java源码编译后生成的java字节码文件

**(2)、resources.arsc：**这是编译后的二进制资源文件

**(3)、AndroidManifest.xml：**这个Manifest文件里面都是编译之后的，都是二进制，看不到什么信息

**(4)、proguard.cfg：**这是代码混淆配置文件

**(5)、**META-INF：该目录下存放的是签名信息，用来保证apk包的完整性和系统的安全

**(6)、res：**该目录下存放的是资源文件，但是也是编译之后的，二进制的。
你试过就会知道，真正容量大的就是classes.dex、资源文件，当然了有时候也会有lib目录，lib目录下放的是一些jar包和so包，容量也是挺大的。

#### 打包过程：
(1)、打包资源文件，生成R.java文件

(2)、处理aidl文件，生成相应java文件

(3)、编译工程源代码，生成相应class文件

(4)、转换所有class文件，生成classes.dex文件

(5)、打包生成apk

(6)、对apk文件进行签名

(7)、对签名后的apk文件进行处理

### 2、Android 内存优化和布局优化

首先我们要了解Java的内存机制，堆区，栈区和方法区：

#### 堆区（共享）
 存储的全部是对象，每个对象都包含一个与之对应的class的信息(class的目的是得到操作指令jvm)；只有一个heap区，被所有线程共享，不存放基本类型和对象引用，只存放对象本身。

堆的优劣势：堆的优势是可以动态的分配内存大小，生存期也不必事先告诉编译器，java的垃圾收集器会自动收取这些不在使用的数据，但缺点是，由于要在运行时动态分配内存，存取速度慢。

#### 栈区（私有）
每一个线程包含一个stack区，只保存基本数据类型的对象和自定义对象的引用（不是对象），对象都存放在共享heap中；每个栈中的数据（基本数据类型和对象引用）都是私有的，其他栈不能访问；栈分为3部分：基本类型变量区、执行环境上下文、操作指令区（存放操作指令）

栈的优势劣势：存取速度比堆要快，仅次于直接位于CPU的寄存器，但必须确定的是存在stack中的数据大小与生存期必须是确定的，缺乏灵活性。单个stack的数据可以共享。

**stack：**是一个先进后出的数据结构，通常保存方法中的参数，局部变量。在java中，所有基本类型和引用类型都在stack中储存，栈中数据的生存空间一般在当前scopes内。

#### 方法区（共享）
又叫静态区，跟堆一样，被所有的线程共享。方法区包含所有的class和static变量；方法区中包含的都是在程序中永远的唯一的元素

#### 内存优化：

**(1)、单例导致内存泄漏：**因为单例的静态特性使得它的生命周期同应用的生命周期一样长，如果一个对象已经没有用处了，但是单例还持有它的引用，那么在整个应用程序的生命周期它都不能正常被回收，从而导致内存泄露。

**(2)、静态变量导致内存泄露：**静态变量存储在方法区，它的生命周期从类加载开始，到整个进程结束。一旦静态变量初始化后，它所持有的引用只有等到进程结束才会释放。

**(3)、非静态内部类导致内存泄露：**非静态内部类（包括匿名内部类）默认就会持有外部类的引用，当非静态内部类对象的生命周期比外部类对象的生命周期长时，就会导致内存泄露。

**(4)、未取消注册或回调导致内存泄露：**比如我们在Activity中注册广播，如果在Activity销毁后不取消注册，那么这个刚播会一直存在系统中，同上面所说的非静态内部类一样持有Activity引用，导致内存泄露。

#### 布局优化：
布局的优化其实说白了就是减少层级，越简单越好，减少overdraw，就能更好的突出性能。下面介绍几种布局优化的方式：

**(1)、首先是善用相对布局Relativelayout（尽量用）：**一般情况下用LinearLayout的时候总会比RelativeLayout多一个View的层级。而每次往应用里面增加一个View，或者增加一个布局管理器的时候，都会增加运行时对系统的消耗，因此这样就会导致界面初始化、布局、绘制的过程变慢。

**(2)、布局优化的另外一种手段就是使用抽象布局标签include、merge、ViewStub：**include标签常用于将布局中的公共部分提取出来；merge标签是作为include标签的一种辅助扩展来使用，它的主要作用是为了防止在引用布局文件时产生多余的布局嵌套；viewstub是view的子类。他是一个轻量级View， 隐藏的，没有尺寸的View。

**(3)、Android最新的布局方式ConstaintLayout：**ConstraintLayout允许你在不适用任何嵌套的情况下创建大型而又复杂的布局。它与RelativeLayout非常相似，所有的view都依赖于兄弟控件和父控件的相对关系。但是，ConstraintLayout比RelativeLayout更加灵活，目前在AndroidStudio中使用也十分方便，就和以前的拖拉控件十分相似。

**(4)、利用Android Lint工具寻求可能优化布局的层次**


### 3、Error和Exception的区别

#### Error
Error类一般是指与虚拟机相关的问题，如系统崩溃，虚拟机错误，内存空间不足，方法调用栈溢出等。如java.lang.StackOverFlowError和Java.lang.OutOfMemoryError。对于这类错误，Java编译器不去检查他们。对于这类错误的导致的应用程序中断，仅靠程序本身无法恢复和预防，遇到这样的错误，建议让程序终止。

#### Exception
Exception类表示程序可以处理的异常，可以捕获且可能恢复。遇到这类异常，应该尽可能处理异常，使程序恢复运行，而不应该随意终止异常。

#### try-catch-finally-return执行顺序
(1)、不管是否有异常产生，finally块中代码都会执行；

(2)、当try和catch中有return语句时，finally块仍然会执行；

(3)、finally是在return后面的表达式运算后执行的，所以函数返回值是在finally执行前确定的。无论finally中的代码怎么样，返回的值都不会改变，仍然是之前return语句中保存的值；

(4)、finally中最好不要包含return，否则程序会提前退出，返回值不是try或catch中保存的返回值。